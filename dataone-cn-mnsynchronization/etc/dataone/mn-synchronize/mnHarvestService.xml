<?xml version="1.0" encoding="UTF-8"?>
<beans default-init-method="init" xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

<!--
    Document   : services.xml
    Created on : June 4, 2010, 1:58 AM
    Author     : rwaltz
    Description:
        Purpose of the document follows.
-->
   <bean id="nodeMapPersistence" class="org.dataone.cn.batch.proto.harvest.persist.NodeMapPersistence" init-method="init">
        <property name="persistentDataFileName" value="${synchronize.persistentNodeLastModifiedDataFileName}" />
        <property name="persistentDataFileNamePath" value="${synchronize.persistentDataFileNamePath}" />
    </bean>

    <bean id="objectListQueueBuilder" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueBuilder">
    	<property name="mnReplication" ref="mnReplicationService" />
    	<property name="nodeMapPersistance" ref="nodeMapPersistence" />
        <property name="mnIdentifier" value="${synchronize.mnIdentifier}" />
        <property name="token" ref="publicToken" />
    </bean>

    <bean id="objectListQueueProcessor" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueProcessor">
        <property name="token" ref="publicToken" />
        <property name="mnReader" ref="mnCrudService" />
        <property name="mnIdentifier" value="${synchronize.mnIdentifier}" />
        <property name="cnIdentifier" value="${synchronize.cnIdentifier}" />
        <property name="validSciMetaObjectFormats" ref="validScienceMetadataFormats" />
    </bean>
    
    <bean id="objectListQueueWriter" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueWriter">
        <property name="token" ref="cnToken" />
        <property name="mnReader" ref="mnCrudService" />
        <property name="cnWriter" ref="cnCrudService" />
        <property name="cnAuthorization" ref="cnAuthorizationService" />
        <property name="mnIdentifier" value="${synchronize.mnIdentifier}" />
        <property name="validSciMetaObjectFormats" ref="validScienceMetadataFormats" />
        <property name="nodeMapPersistance" ref="nodeMapPersistence" />
    </bean>

<!-- the last step in this pipeline should be to update the node list so that the synchronized date is set -->

</beans>
